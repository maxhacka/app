# Сервис "Certificates"

Сервис "Certificates" предоставляет API для управления сертификатами, их типами и статистикой.

## API Эндпоинты

### Сертификаты

- `GET /api/certificates`:
  - Получить список всех сертификатов.
  - Параметры запроса:
    - `max_user_id` (опционально, int) - фильтр по max_user_id пользователя
    - `certificate_type` (опционально, str) - фильтр по типу сертификата
    - `status` (опционально, str) - фильтр по статусу сертификата
    - `skip` (по умолчанию: 0) - количество пропускаемых записей
    - `limit` (по умолчанию: 100) - лимит записей
  - Возвращает список объектов `Certificate`, отсортированных по дате запроса (от новых к старым).
  - Требует аутентификации.

- `GET /api/certificates/{certificate_id}`:
  - Получить сертификат по его ID.
  - Возвращает объект `Certificate`.
  - Выдает ошибку 404, если сертификат не найден.

- `POST /api/certificates`:
  - Создать новый сертификат.
  - Принимает объект `CertificateCreate` с полями:
    - `max_user_id` (int) - ID пользователя
    - `user_type` (str) - тип пользователя
    - `certificate_type` (str) - тип сертификата
    - `purpose` (str, опционально) - назначение сертификата
    - `delivery_method` (str, по умолчанию: "pickup") - способ доставки
    - `delivery_address` (str, опционально) - адрес доставки
    - `comments` (str, опционально) - комментарии
  - Цена сертификата автоматически устанавливается на основе типа сертификата.
  - Статус по умолчанию: "processing".
  - Возвращает созданный объект `Certificate`.
  - Требует аутентификации.

- `PUT /api/certificates/{certificate_id}`:
  - Обновить существующий сертификат по его ID.
  - Принимает объект `CertificateUpdate` с опциональными полями:
    - `status` (str, опционально) - статус сертификата
    - `ready_date` (datetime, опционально) - дата готовности
    - `issue_date` (datetime, опционально) - дата выдачи
    - `delivery_method` (str, опционально) - способ доставки
    - `delivery_address` (str, опционально) - адрес доставки
    - `price` (float, опционально) - цена
    - `comments` (str, опционально) - комментарии
    - `document_url` (str, опционально) - URL документа
  - Возвращает обновленный объект `Certificate`.
  - Выдает ошибку 404, если сертификат не найден.
  - Требует аутентификации.

- `DELETE /api/certificates/{certificate_id}`:
  - Удалить сертификат по его ID.
  - Возвращает сообщение об успешном удалении: `{"message": "Certificate deleted successfully"}`.
  - Выдает ошибку 404, если сертификат не найден.

### Типы сертификатов

- `GET /api/certificate-types`:
  - Получить список всех типов сертификатов.
  - Параметры запроса:
    - `is_active` (опционально, int) - фильтр по активности типа (1 - активный, 0 - неактивный)
    - `skip` (по умолчанию: 0) - количество пропускаемых записей
    - `limit` (по умолчанию: 100) - лимит записей
  - Возвращает список объектов `CertificateType`.
  - Требует аутентификации.

- `GET /api/certificate-types/{cert_type_id}`:
  - Получить тип сертификата по его ID.
  - Возвращает объект `CertificateType`.
  - Выдает ошибку 404, если тип сертификата не найден.

- `POST /api/certificate-types`:
  - Создать новый тип сертификата.
  - Принимает объект `CertificateTypeCreate` с полями:
    - `name` (str) - название типа (уникальное)
    - `description` (str, опционально) - описание типа
    - `price` (float, по умолчанию: 0.0) - цена сертификата
    - `processing_days` (int, по умолчанию: 3) - количество дней на обработку
    - `is_active` (int, по умолчанию: 1) - активность типа
  - Возвращает созданный объект `CertificateType`.
  - Требует аутентификации.

- `PUT /api/certificate-types/{cert_type_id}`:
  - Обновить существующий тип сертификата по его ID.
  - Принимает объект `CertificateTypeUpdate` с опциональными полями:
    - `name` (str, опционально) - новое название типа
    - `description` (str, опционально) - новое описание
    - `price` (float, опционально) - новая цена
    - `processing_days` (int, опционально) - новое количество дней на обработку
    - `is_active` (int, опционально) - новая активность типа
  - Возвращает обновленный объект `CertificateType`.
  - Выдает ошибку 404, если тип сертификата не найден.
  - Требует аутентификации.

- `DELETE /api/certificate-types/{cert_type_id}`:
  - Удалить тип сертификата по его ID.
  - Возвращает сообщение об успешном удалении: `{"message": "Certificate type deleted successfully"}`.
  - Выдает ошибку 404, если тип сертификата не найден.

### Статистика

- `GET /api/statistics`:
  - Получить статистику по сертификатам.
  - Возвращает объект `CertificateStatistics` с полями:
    - `total_certificates` - общее количество сертификатов
    - `pending_certificates` - количество сертификатов со статусом "pending"
    - `processing_certificates` - количество сертификатов со статусом "processing"
    - `ready_certificates` - количество сертификатов со статусом "ready"
    - `issued_certificates` - количество сертификатов со статусом "issued"
    - `cancelled_certificates` - количество сертификатов со статусом "cancelled"
    - `certificates_by_type` - словарь с количеством сертификатов по типам
    - `total_revenue` - общая выручка (в текущей реализации всегда 0.0)

### Служебные эндпоинты

- `GET /`:
  - Информация о сервисе.
  - Возвращает объект с полями: `service`, `version`, `status`.

- `GET /health`:
  - Проверка здоровья сервиса.
  - Возвращает объект с полем `status: "healthy"`.

## Особенности

- **Автоматическое определение цены**: При создании сертификата цена автоматически устанавливается на основе типа сертификата.
- **Статусы сертификатов**: 
  - `pending` - ожидает обработки
  - `processing` - в обработке (статус по умолчанию)
  - `ready` - готов к выдаче
  - `issued` - выдан
  - `cancelled` - отменен
- **Способы доставки**: По умолчанию используется "pickup" (самовывоз).
- **Аутентификация**: Большинство эндпоинтов требуют аутентификации через токен (кроме GET запросов к отдельным ресурсам и служебных эндпоинтов).
