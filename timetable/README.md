# Сервис "Timetable"

Сервис "Timetable" предоставляет API для управления расписанием занятий, шаблонами расписаний, изменениями в расписании, группами и предметами.

## API Эндпоинты

### Расписание

- `GET /api/timetable/schedule`:
  - Получить список всех записей расписания.
  - Параметры запроса:
    - `group_name` (опционально, str) - фильтр по названию группы
    - `day_of_week` (опционально, str) - фильтр по дню недели
    - `teacher_id` (опционально, int) - фильтр по ID преподавателя
    - `date_created_on` (опционально, date) - фильтр по дате создания расписания
    - `skip` (по умолчанию: 0) - количество пропускаемых записей
    - `limit` (по умолчанию: 100) - лимит записей
  - Возвращает список объектов `Schedule`.
  - Требует аутентификации.

- `GET /api/timetable/schedule/{schedule_id}`:
  - Получить запись расписания по ее ID.
  - Возвращает объект `Schedule`.
  - Выдает ошибку 404, если запись расписания не найдена.
  - Требует аутентификации.

- `POST /api/timetable/schedule`:
  - Создать новую запись расписания.
  - Принимает объект `ScheduleCreate` с полями:
    - `group_name` (str) - название группы
    - `day_of_week` (str) - день недели
    - `time_start` (str) - время начала занятия
    - `time_end` (str) - время окончания занятия
    - `subject` (str) - название предмета
    - `teacher` (str) - имя преподавателя
    - `teacher_id` (int, опционально) - ID преподавателя
    - `room` (str) - аудитория
    - `type` (str, по умолчанию: "lecture") - тип занятия (lecture, seminar, lab, etc.)
    - `week_type` (str, опционально) - тип недели (например, "odd", "even")
    - `date_created_on` (date) - дата создания расписания
  - Возвращает созданный объект `Schedule`.
  - Требует аутентификации.

- `PUT /api/timetable/schedule/{schedule_id}`:
  - Обновить существующую запись расписания по ее ID.
  - Принимает объект `ScheduleUpdate` с опциональными полями (все поля из `ScheduleCreate`).
  - Возвращает обновленный объект `Schedule`.
  - Выдает ошибку 404, если запись расписания не найдена.
  - Требует аутентификации.

- `DELETE /api/timetable/schedule/{schedule_id}`:
  - Удалить запись расписания по ее ID.
  - Возвращает сообщение об успешном удалении: `{"message": "Schedule deleted successfully"}`.
  - Выдает ошибку 404, если запись расписания не найдена.
  - Требует аутентификации.

### Шаблоны расписаний

- `GET /api/timetable/templates`:
  - Получить список всех шаблонов расписаний.
  - Параметры запроса:
    - `is_active` (опционально, int) - фильтр по активности шаблона (1 - активный, 0 - неактивный)
    - `skip` (по умолчанию: 0) - количество пропускаемых записей
    - `limit` (по умолчанию: 100) - лимит записей
  - Возвращает список объектов `ScheduleTemplate`.
  - Требует аутентификации.

- `GET /api/timetable/templates/{template_id}`:
  - Получить шаблон расписания по его ID.
  - Возвращает объект `ScheduleTemplate`.
  - Выдает ошибку 404, если шаблон не найден.
  - Требует аутентификации.

- `POST /api/timetable/templates`:
  - Создать новый шаблон расписания.
  - Принимает объект `ScheduleTemplateCreate` с полями:
    - `name` (str) - название шаблона
    - `description` (str, опционально) - описание шаблона
    - `semester` (str, опционально) - семестр
    - `year` (int, опционально) - учебный год
    - `is_active` (int, по умолчанию: 0) - активность шаблона
  - Возвращает созданный объект `ScheduleTemplate`.
  - Требует аутентификации.

- `PUT /api/timetable/templates/{template_id}`:
  - Обновить существующий шаблон расписания по его ID.
  - Принимает объект `ScheduleTemplateUpdate` с опциональными полями (все поля из `ScheduleTemplateCreate`).
  - Возвращает обновленный объект `ScheduleTemplate`.
  - Выдает ошибку 404, если шаблон не найден.
  - Требует аутентификации.

- `DELETE /api/timetable/templates/{template_id}`:
  - Удалить шаблон расписания по его ID.
  - Возвращает сообщение об успешном удалении: `{"message": "Template deleted successfully"}`.
  - Выдает ошибку 404, если шаблон не найден.
  - Требует аутентификации.

### Изменения в расписании

- `GET /api/timetable/changes`:
  - Получить список всех изменений в расписании.
  - Параметры запроса:
    - `schedule_id` (опционально, int) - фильтр по ID расписания
    - `date_from` (опционально, date) - фильтр по дате изменения (изменения с датой >= date_from)
    - `skip` (по умолчанию: 0) - количество пропускаемых записей
    - `limit` (по умолчанию: 100) - лимит записей
  - Возвращает список объектов `ScheduleChange`, отсортированных по дате.
  - Требует аутентификации.

- `GET /api/timetable/changes/{change_id}`:
  - Получить изменение в расписании по его ID.
  - Возвращает объект `ScheduleChange`.
  - Выдает ошибку 404, если изменение не найдено.
  - Требует аутентификации.

- `POST /api/timetable/changes`:
  - Создать новое изменение в расписании.
  - Принимает объект `ScheduleChangeCreate` с полями:
    - `schedule_id` (int) - ID записи расписания
    - `date` (date) - дата изменения
    - `change_type` (str) - тип изменения
    - `new_time_start` (str, опционально) - новое время начала
    - `new_time_end` (str, опционально) - новое время окончания
    - `new_room` (str, опционально) - новая аудитория
    - `new_teacher` (str, опционально) - новый преподаватель
    - `reason` (str, опционально) - причина изменения
  - Возвращает созданный объект `ScheduleChange`.
  - Требует аутентификации.

- `PUT /api/timetable/changes/{change_id}`:
  - Обновить существующее изменение в расписании по его ID.
  - Принимает объект `ScheduleChangeUpdate` с опциональными полями (все поля из `ScheduleChangeCreate`).
  - Возвращает обновленный объект `ScheduleChange`.
  - Выдает ошибку 404, если изменение не найдено.
  - Требует аутентификации.

- `DELETE /api/timetable/changes/{change_id}`:
  - Удалить изменение в расписании по его ID.
  - Возвращает сообщение об успешном удалении: `{"message": "Change deleted successfully"}`.
  - Выдает ошибку 404, если изменение не найдено.
  - Требует аутентификации.

### Группы

- `GET /api/timetable/groups`:
  - Получить список всех групп.
  - Параметры запроса:
    - `is_active` (опционально, int) - фильтр по активности группы (1 - активная, 0 - неактивная)
    - `skip` (по умолчанию: 0) - количество пропускаемых записей
    - `limit` (по умолчанию: 100) - лимит записей
  - Возвращает список объектов `Group`, отсортированных по названию.
  - Требует аутентификации.

- `GET /api/timetable/groups/{group_id}`:
  - Получить группу по ее ID.
  - Возвращает объект `Group`.
  - Выдает ошибку 404, если группа не найдена.
  - Требует аутентификации.

- `POST /api/timetable/groups`:
  - Создать новую группу.
  - Принимает объект `GroupCreate` с полями:
    - `name` (str) - название группы (уникальное)
    - `description` (str, опционально) - описание группы
    - `is_active` (int, по умолчанию: 1) - активность группы
  - Возвращает созданный объект `Group`.
  - Выдает ошибку 400, если группа с таким названием уже существует.
  - Требует аутентификации.

- `PUT /api/timetable/groups/{group_id}`:
  - Обновить существующую группу по ее ID.
  - Принимает объект `GroupUpdate` с опциональными полями (все поля из `GroupCreate`).
  - При обновлении названия проверяется его уникальность.
  - Возвращает обновленный объект `Group`.
  - Выдает ошибку 404, если группа не найдена.
  - Выдает ошибку 400, если группа с новым названием уже существует.
  - Требует аутентификации.

- `DELETE /api/timetable/groups/{group_id}`:
  - Удалить группу по ее ID.
  - Возвращает сообщение об успешном удалении: `{"message": "Group deleted successfully"}`.
  - Выдает ошибку 404, если группа не найдена.
  - Требует аутентификации.

### Предметы

- `GET /api/timetable/subjects`:
  - Получить список всех предметов.
  - Параметры запроса:
    - `is_active` (опционально, int) - фильтр по активности предмета (1 - активный, 0 - неактивный)
    - `skip` (по умолчанию: 0) - количество пропускаемых записей
    - `limit` (по умолчанию: 100) - лимит записей
  - Возвращает список объектов `Subject`, отсортированных по названию.
  - Требует аутентификации.

- `GET /api/timetable/subjects/{subject_id}`:
  - Получить предмет по его ID.
  - Возвращает объект `Subject`.
  - Выдает ошибку 404, если предмет не найден.
  - Требует аутентификации.

- `POST /api/timetable/subjects`:
  - Создать новый предмет.
  - Принимает объект `SubjectCreate` с полями:
    - `name` (str) - название предмета (уникальное)
    - `description` (str, опционально) - описание предмета
    - `is_active` (int, по умолчанию: 1) - активность предмета
  - Возвращает созданный объект `Subject`.
  - Выдает ошибку 400, если предмет с таким названием уже существует.
  - Требует аутентификации.

- `PUT /api/timetable/subjects/{subject_id}`:
  - Обновить существующий предмет по его ID.
  - Принимает объект `SubjectUpdate` с опциональными полями (все поля из `SubjectCreate`).
  - При обновлении названия проверяется его уникальность.
  - Возвращает обновленный объект `Subject`.
  - Выдает ошибку 404, если предмет не найден.
  - Выдает ошибку 400, если предмет с новым названием уже существует.
  - Требует аутентификации.

- `DELETE /api/timetable/subjects/{subject_id}`:
  - Удалить предмет по его ID.
  - Возвращает сообщение об успешном удалении: `{"message": "Subject deleted successfully"}`.
  - Выдает ошибку 404, если предмет не найден.
  - Требует аутентификации.

### Служебные эндпоинты

- `GET /`:
  - Информация о сервисе.
  - Возвращает объект с полями: `service`, `version`, `status`.

- `GET /health`:
  - Проверка здоровья сервиса.
  - Возвращает объект с полем `status: "healthy"`.

## Особенности

- **Типы занятий**: Поддерживаются различные типы занятий (lecture, seminar, lab и др.). По умолчанию используется "lecture".
- **Типы недель**: Расписание может учитывать четные/нечетные недели через поле `week_type`.
- **Изменения в расписании**: Система отслеживает изменения в расписании с указанием типа изменения, новых параметров и причины.
- **Справочники**: Управление группами и предметами через отдельные эндпоинты для использования в формах и фильтрах.
- **Уникальность**: Названия групп и предметов должны быть уникальными.
- **Активность**: Группы, предметы и шаблоны имеют флаг активности для управления их видимостью.
- **Фильтрация**: Поддерживается фильтрация расписания по группе, дню недели, преподавателю и дате создания.
- **Сортировка**: Группы и предметы сортируются по названию, изменения в расписании - по дате.
- **Аутентификация**: Все эндпоинты требуют аутентификации через токен (кроме служебных эндпоинтов).
- **Обработка ошибок**: При нарушении уникальности возвращается ошибка 400 с описанием проблемы.
