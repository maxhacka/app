## –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞

–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ –∏ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ —Ç–æ–∫–µ–Ω [–≤ @MasterBot](https://max.ru/masterbot).

–≠—Ç–æ—Ç —Ç–æ–∫–µ–Ω –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –≤–µ–∑–¥–µ, –≥–¥–µ –Ω–∞–ø–∏—Å–∞–Ω–æ `'TOKEN'`.

## –≠—Ö–æ-–±–æ—Ç

```py
import aiomax
import asyncio

bot = aiomax.Bot('TOKEN')

@bot.on_message()
async def echo(message: aiomax.Message):
    await message.reply(message.body.text)

bot.run()
```

## –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–∞–Ω–¥–æ–º–Ω—ã—Ö —á–∏—Å–µ–ª

```py
import aiomax
import asyncio
import random

bot = aiomax.Bot('TOKEN', default_format='markdown')

# –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª: /random –º–∏–Ω–∏–º—É–º –º–∞–∫—Å–∏–º—É–º
@bot.on_command('random', aliases=['rnd'])
async def gen(ctx: aiomax.CommandContext):
    try:
        min_num = int(ctx.args[0])
        max_num = int(ctx.args[1])
        number = random.randint(min_num, max_num)
    except:
        await ctx.reply('**–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã!**\n\n/random <–º–∏–Ω–∏–º–º—É–º> <–º–∞–∫—Å–∏–º—É–º>')
        return

    await ctx.reply(f'–í–∞—à–µ —á–∏—Å–ª–æ: **{number}**')

# –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ —á–∞—Ç–∞ —Å –±–æ—Ç–æ–º
@bot.on_bot_start()
async def on_bot_start(payload: aiomax.BotStartPayload):
    await payload.send('**–ú–æ—è –∫–æ–º–∞–Ω–¥–∞:**\n\n/random <–º–∏–Ω–∏–º—É–º> <–º–∞–∫—Å–∏–º—É–º>')

# –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —á—Ç–æ–±—ã –æ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –º–µ–Ω—é
@bot.on_ready()
async def send_commands():
    await bot.patch_me(commands=[
        aiomax.BotCommand('random', '–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç –º–∏–Ω–∏–º—É–º–∞ –¥–æ –º–∞–∫—Å–∏–º—É–º–∞')
    ])

bot.run()
```

## –≠—Ö–æ-–±–æ—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ —á–∞—Ç

```py
import aiomax
import asyncio

bot = aiomax.Bot('TOKEN')

chat_id: int = 2409 # ID —á–∞—Ç–∞, —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ—Ç–æ—Ä–æ–º –¥–æ–ª–∂–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—Å—è

@bot.on_message(lambda message: message.recipient.chat_id == chat_id)
async def echo(message: aiomax.Message):
    await message.send(message.body.text)

bot.run()
```

## –ü—Ä–æ—Å—Ç–æ–π —Å—á—ë—Ç—á–∏–∫ —Å–æ —Å–±—Ä–æ—Å–æ–º

```py
import aiomax
import asyncio

bot = aiomax.Bot('TOKEN')
taps = 0

# –ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∞—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
@bot.on_command('tap')
async def tap_command(ctx: aiomax.CommandContext):
    kb = aiomax.buttons.KeyboardBuilder()
    kb.add(aiomax.buttons.CallbackButton('–¢–∞–ø', 'tap'))
    kb.row(aiomax.buttons.CallbackButton('–°–±—Ä–æ—Å–∏—Ç—å', 'reset'))

    await ctx.reply(f'–¢–∞–ø–æ–≤: {taps}', keyboard=kb)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–¢–∞–ø" (—É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞)
@bot.on_button_callback(lambda data: data.payload == 'tap')
async def tap(cb: aiomax.Callback):
    global taps
    taps += 1
    await cb.answer(text=f'–¢–∞–ø–æ–≤: {taps}', format='markdown')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å" (—Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞)
@bot.on_button_callback(lambda data: data.payload == 'reset')
async def reset(cb: aiomax.Callback):
    global taps
    taps = 0
    await cb.answer('–í—ã —Å–±—Ä–æ—Å–∏–ª–∏ –≤—Å–µ —Ç–∞–ø—ã!', text=f'–¢–∞–ø–æ–≤: {taps}')

bot.run()
```

## –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä—ã

### `echo.py`

```py
import aiomax

router = aiomax.Router()

@router.on_message()
async def echo(message: aiomax.Message):
    await message.reply(message.content)
```

### `main.py`

```py
import aiomax
import echo

bot = aiomax.Bot('TOKEN')
bot.add_router(echo.router)

bot.run()
```

## –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã

```py
import aiomax

bot = aiomax.Bot('TOKEN')
command_router = aiomax.Router()
command_router.add_message_filter(aiomax.filters.startswith('$'))

# —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å '$'

@command_router.on_message()
async def echo(message: aiomax.Message):
    await message.reply(message.content)

@command_router.on_message()
async def name(message: aiomax.Message):
    await message.reply(message.sender.name)

# —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞

@bot.on_message()
async def echo(message: aiomax.Message):
    await message.reply(message.content)

bot.add_router(command_router)
bot.run()
```

## –í–≤–æ–¥ –∏–º–µ–Ω–∏ –∏ —Ñ–∞–º–∏–ª–∏–∏ —Å –ø–æ–º–æ—â—å—é FSM

```py
import aiomax
from aiomax import fsm

bot = aiomax.Bot('TOKEN')


# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
@bot.on_bot_start()
async def start(pd: aiomax.BotStartPayload, cursor: fsm.FSMCursor):
    await pd.send("–ö–∞–∫ –í–∞—Å –∑–æ–≤—É—Ç?")
    cursor.change_state('name')  # –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ


# –í–≤–æ–¥ –∏–º–µ–Ω–∏
@bot.on_message(aiomax.filters.state('name'))
async def write_name(message: aiomax.Message, cursor: fsm.FSMCursor):
    await message.reply("–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ—é —Ñ–∞–º–∏–ª–∏—é")
    cursor.change_state('surname')  # –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    cursor.change_data({'name': message.content})  # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –≤ –¥–∞–Ω–Ω—ã–µ

# –í–≤–æ–¥ —Ñ–∞–º–∏–ª–∏–∏
@bot.on_message(aiomax.filters.state('surname'))
async def write_surname(message: aiomax.Message, cursor: fsm.FSMCursor):
    name = cursor.get_data()['name']  # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö
    surname = message.content

    await message.reply(f"–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {name} {surname}")
    cursor.clear()  # –û—á–∏—â–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

bot.run()
```

## –ë–æ—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ–∫—Å–∏

```py
import aiomax
import aiohttp
import asyncio

bot = aiomax.Bot('TOKEN')

proxy_url = 'http://url:port'
proxy_auth = aiohttp.BasicAuth("login", "pasword") # –ê—É—Ç–µ–Ω—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –≤—ã–≤–æ–¥ —Å—Ç—Ä–∞–Ω—ã
@bot.on_command()
async def example(ctx: aiomax.CommandContext):
    response = await bot.session.get("http://ip-api.com/json/")
    data = await response.json()
    await ctx.send(f"Country: {data.get('country')}")


async def main():
    session = aiohttp.ClientSession(proxy=proxy_url, proxy_auth=proxy_auth)
    await bot.start_polling(session)

if __name__ == "__main__":
    asyncio.run(main())
```

## –ë–æ—Ç —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤

```py
import aiomax

bot = aiomax.Bot('TOKEN')

@bot.on_command('send_photo')
async def send_photo(ctx: aiomax.CommandContext):
    attachment = await bot.upload_image('image.png')
    await ctx.send('–§–æ—Ç–æ', attachments=attachment)

bot.run()
```

## –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–æ–≤ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–¥–∞ —Å—Ç–∏–∫–µ—Ä–∞

```py
import aiomax

bot = aiomax.Bot('TOKEN')

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –∫–æ–¥–æ–º (2613f6)
@bot.on_command('send_sticker')
async def sticker(ctx: aiomax.CommandContext):
    await ctx.reply(attachments=[
        aiomax.StickerAttachment('2613f6')
    ])

# –û—Ç–≤–µ—Ç –∫–æ–¥–æ–º —Å—Ç–∏–∫–µ—Ä–∞ –Ω–∞ –ª—é–±–æ–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –±–æ—Ç—É —Å—Ç–∏–∫–µ—Ä
@bot.on_message()
async def get_code(message: aiomax.Message):
    for i in message.body.attachments:
        if i.type == 'sticker':
            await message.reply(i.code)
            return

bot.run()
```

## ‚ú® –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞

```py
import aiomax
from aiomax.buttons import KeyboardBuilder, ContactButton

bot = aiomax.Bot('TOKEN')

# –ó–∞–ø—Ä–æ—Å –∫–æ–Ω—Ç–∞–∫—Ç–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
@bot.on_command('contact')
async def request_contact(ctx: aiomax.CommandContext):
    kb = KeyboardBuilder()
    kb.add(ContactButton("–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º"))
    
    await ctx.send(
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –∫–æ–Ω—Ç–∞–∫—Ç–æ–º, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ —Å –≤–∞–º–∏ —Å–≤—è–∑–∞—Ç—å—Å—è:",
        keyboard=kb
    )

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞
@bot.on_message()
async def handle_contact(message: aiomax.Message):
    for attachment in message.body.attachments:
        if attachment.type == "contact":
            # –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ vcf_info
            phone = attachment.vcf_phone
            user_info = attachment.max_info
            
            response = "–ö–æ–Ω—Ç–∞–∫—Ç –ø–æ–ª—É—á–µ–Ω!\n\n"
            
            if user_info:
                response += f"–ò–º—è: {user_info.name}\n"
            
            if phone:
                response += f"–¢–µ–ª–µ—Ñ–æ–Ω: +{phone}\n"
            else:
                response += "–¢–µ–ª–µ—Ñ–æ–Ω: –Ω–µ —É–∫–∞–∑–∞–Ω\n"
            
            await message.reply(response)
            return

bot.run()
```

## ‚ú® –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä

```py
import aiomax
from aiomax.buttons import KeyboardBuilder

bot = aiomax.Bot('TOKEN')

@bot.on_command('menu')
async def show_menu(ctx: aiomax.CommandContext):
    # –ù–æ–≤—ã–π —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä
    kb = KeyboardBuilder()
    kb.button("–ì–ª–∞–≤–Ω–∞—è", callback_data="home")
    kb.button("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="stats")
    kb.button("–ù–∞—Å—Ç—Ä–æ–π–∫–∏", callback_data="settings")
    kb.button("–û –±–æ—Ç–µ", callback_data="about")
    kb.button("–°–∞–π—Ç", url="https://example.com")
    kb.adjust(2, 2, 1)  # –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º: 2 –∫–Ω–æ–ø–∫–∏, 2 –∫–Ω–æ–ø–∫–∏, 1 –∫–Ω–æ–ø–∫–∞
    
    await ctx.send("–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", keyboard=kb)

@bot.on_button_callback()
async def handle_callback(callback: aiomax.Callback):
    responses = {
        "home": "–í—ã –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é",
        "stats": "–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
        "settings": "–ó–¥–µ—Å—å –±—É–¥—É—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏",
        "about": "–Ø –±–æ—Ç –Ω–∞ AIOMAX!"
    }
    
    text = responses.get(callback.payload, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞")
    await callback.answer(notification=text)

bot.run()
```

## ‚ú® –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ FSM —Å –Ω–æ–≤—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º

```py
import aiomax
from aiomax.fsm import StatesGroup, State
from aiomax import filters
from aiomax.buttons import KeyboardBuilder

bot = aiomax.Bot('TOKEN')

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥—Ä—É–ø–ø—É —Å–æ—Å—Ç–æ—è–Ω–∏–π
class OrderStates(StatesGroup):
    choosing_product = State()
    choosing_quantity = State()
    confirming = State()

@bot.on_command('order')
async def start_order(ctx, cursor):
    products = ["üçï –ü–∏—Ü—Ü–∞", "üçî –ë—É—Ä–≥–µ—Ä", "ü•ó –°–∞–ª–∞—Ç", "ü•§ –ù–∞–ø–∏—Ç–æ–∫"]
    
    kb = KeyboardBuilder()
    for product in products:
        kb.button(product, callback_data=f"product_{product}")
    kb.adjust(2)
    
    await ctx.send("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä:", keyboard=kb)
    cursor.set_state(OrderStates.choosing_product)

@bot.on_button_callback(filters.state(OrderStates.choosing_product))
async def process_product(callback, cursor):
    product = callback.payload.replace("product_", "")
    cursor.update_data(product=product)
    
    kb = KeyboardBuilder()
    for i in range(1, 6):
        kb.button(str(i), callback_data=f"qty_{i}")
    kb.adjust(5)
    
    await callback.answer(notification=f"–í—ã–±—Ä–∞–Ω: {product}")
    await callback.send(f"–í—ã–±—Ä–∞–Ω–æ: {product}\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:", keyboard=kb)
    cursor.set_state(OrderStates.choosing_quantity)

@bot.on_button_callback(filters.state(OrderStates.choosing_quantity))
async def process_quantity(callback, cursor):
    quantity = int(callback.payload.replace("qty_", ""))
    cursor.update_data(quantity=quantity)
    
    data = cursor.get_data()
    
    kb = KeyboardBuilder()
    kb.button("–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å", callback_data="confirm")
    kb.button("–û—Ç–º–µ–Ω–∏—Ç—å", callback_data="cancel")
    
    await callback.send(
        f"–í–∞—à –∑–∞–∫–∞–∑:\n"
        f"–¢–æ–≤–∞—Ä: {data['product']}\n"
        f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {data['quantity']}",
        keyboard=kb
    )
    cursor.set_state(OrderStates.confirming)

@bot.on_button_callback(filters.state(OrderStates.confirming))
async def confirm_order(callback, cursor):
    if callback.payload == "confirm":
        data = cursor.get_data()
        await callback.answer(notification="–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!")
        await callback.send(
            f"–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑!\n"
            f"{data['product']} x {data['quantity']}"
        )
    else:
        await callback.answer(notification="–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω")
        await callback.send("–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω")
    
    await cursor.finish()

bot.run()
```
